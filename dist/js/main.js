function DoorBase(e,o){function t(){this.isDisabled||this.openPopup()}function i(){this.closePopup()}this.number=e,this.onUnclockCallback=o,this.level=document.querySelector(".level_"+e),this.door=document.querySelector(".door_level_"+e),this.popup=document.querySelector(".popup_level_"+e),this.close=this.popup.querySelector(".popup__close"),this.isLocked=!0,this.isDisabled=this.door.classList.contains("door_disabled"),this.door.addEventListener("click",t.bind(this)),this.close.addEventListener("click",i.bind(this))}function Door0(e,o){function t(e){e.target.classList.add("door-riddle__button_pressed"),s.apply(this)}function i(e){e.target.classList.remove("door-riddle__button_pressed")}function s(){var e=!0;r.forEach(function(o){o.classList.contains("door-riddle__button_pressed")||(e=!1)}),e&&this.unlock()}DoorBase.apply(this,arguments);var r=[this.popup.querySelector(".door-riddle__button_0"),this.popup.querySelector(".door-riddle__button_1"),this.popup.querySelector(".door-riddle__button_2")];r.forEach(function(e){e.addEventListener("pointerdown",t.bind(this)),e.addEventListener("pointerup",i.bind(this)),e.addEventListener("pointercancel",i.bind(this)),e.addEventListener("pointerleave",i.bind(this))}.bind(this))}function Door1(e,o){function t(e){e.target.setPointerCapture(e.pointerId),e.target.classList.add("door-riddle__key_pressed"),s(e)}function i(e){s(e)}function s(e){e.target.classList.contains("door-riddle__key_pressed")&&(e.target.style.left=e.pageX-e.target.offsetWidth/2+"px",e.target.style.top=e.pageY-e.target.offsetHeight/2+"px")}function r(e){e.target.classList.contains("door-riddle__key_pressed")&&e.target.classList.remove("door-riddle__key_pressed"),doElsCollide(l,p,1,1)===!0&&(l.classList.add("door-riddle__key_unlocked"),p.style.display="none"),doElsCollide(c,a,1,1)===!0&&(c.classList.add("door-riddle__key_unlocked"),a.style.display="none"),n.apply(this)}function n(){var e=!0;d.forEach(function(o){o.classList.contains("door-riddle__key_unlocked")||(e=!1)}),e&&this.unlock()}DoorBase.apply(this,arguments);var d=[this.popup.querySelector(".door-riddle__key_yellow"),this.popup.querySelector(".door-riddle__key_green")];d.forEach(function(e){e.addEventListener("pointerdown",t.bind(this)),e.addEventListener("pointermove",i.bind(this)),e.addEventListener("pointerup",r.bind(this)),e.addEventListener("pointercancel",r.bind(this)),e.addEventListener("pointerleave",r.bind(this))}.bind(this)),doElsCollide=function(e,o,t,i){var s=document.body.getBoundingClientRect(),r=e.getBoundingClientRect(),n=o.getBoundingClientRect();return e.offsetBottom=r.top-s.top+t*e.offsetHeight,e.offsetRight=r.left-s.left+t*e.offsetWidth,o.offsetBottom=n.top-s.top+i*o.offsetHeight,o.offsetRight=n.left-s.left+i*o.offsetWidth,!(e.offsetBottom<n.top-s.top||r.top-s.top>o.offsetBottom||e.offsetRight<n.left-s.left||r.left-s.left>o.offsetRight)};var l=document.querySelector(".door-riddle__key_green"),p=document.querySelector(".door-riddle__lock_green"),c=document.querySelector(".door-riddle__key_yellow"),a=document.querySelector(".door-riddle__lock_yellow")}function Door2(e,o){DoorBase.apply(this,arguments),this.popup.addEventListener("click",function(){this.unlock()}.bind(this))}function Box(e,o){function t(e){e.target.classList.add("boss-riddle__eye_pressed"),s.apply(this)}function i(e){e.target.classList.remove("boss-riddle__eye_pressed")}function s(){var e=!0;r.forEach(function(o){o.classList.contains("boss-riddle__eye_pressed")||(e=!1)}),e&&this.unlock()}DoorBase.apply(this,arguments);var r=[this.popup.querySelector(".boss-riddle__eye"),this.popup.querySelector(".boss-riddle__eye")];r.forEach(function(e){e.addEventListener("pointerdown",t.bind(this)),e.addEventListener("pointerup",i.bind(this)),e.addEventListener("pointercancel",i.bind(this)),e.addEventListener("pointerleave",i.bind(this))}.bind(this)),this.showCongratulations=function(){alert("Поздравляю! Игра пройдена!")}}function App(e){function o(){for(var e,o=0;o<t.length;o++)if(t[o].isLocked){if(e&&t[o].isLocked){t[o].enable();break}}else e=!0}var t=[new Door0(0,o),new Door1(1,o),new Door2(2,o),new Box(3,o)];this.doors=t}DoorBase.prototype={openPopup:function(){this.popup.classList.remove("popup_hidden")},closePopup:function(){this.popup.classList.add("popup_hidden")},enable:function(){this.door.classList.remove("door_disabled"),this.isDisabled=!1},unlock:function(){this.door.classList.remove("door_locked"),this.isLocked=!1,this.closePopup(),this.onUnclockCallback(),this.showCongratulations()},showCongratulations:function(){alert("Дверь "+this.number+" открыта!")}},Door0.prototype=Object.create(DoorBase.prototype),Door0.prototype.constructor=DoorBase,Door1.prototype=Object.create(DoorBase.prototype),Door1.prototype.constructor=DoorBase,Door2.prototype=Object.create(DoorBase.prototype),Door2.prototype.constructor=DoorBase,Box.prototype=Object.create(DoorBase.prototype),Box.prototype.constructor=DoorBase;var app=new App(document.querySelector(".app"));
//# sourceMappingURL=main.js.map
